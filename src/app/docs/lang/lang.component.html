<article>
	<h1>The Ecsact Language</h1>
	<p>
		This article gives you everything you need to know on how to write
		<code>.ecsact</code> files.
	</p>

	<h2 id="syntax">Syntax</h2>
	<p>
		Ecsact language syntax is composed of a series of statements that end with
		<code>;</code> or a block of new statements surrounded by
		<code>{{ '{' }}</code> <code>{{ '}' }}</code
		>. Statements within blocks are contextually relevant to the statement it
		proceeds.
	</p>
	<pre><code ecsactLangSyntax>
		statement;
		statement {{'{'}}
			statement;
			statement {{'{'}}
				statement;
			{{'}'}}
		{{'}'}}
	</code></pre>
	<p>
		An empty block is the same as having no block. Both these statements are
		equivalent.
	</p>
	<pre><code ecsactLangSyntax>
		statement;
		statement {{'{}'}}
	</code></pre>
	<p>
		Comments are also allowed. Anything after <code>//</code> on the same line
		or anything between <code>/*</code> and <code>*/</code> across multiple
		lines are considered comments.
	</p>
	<pre><code ecsactLangSyntax>
		// This line is a comment
		/*
		This entire block across multiple
		lines is a comment.
		*/
	</code></pre>

	<h3 id="top-level-statements">Top Level Statements</h3>
	<p>Top level statements are separated into 3 sections.</p>
	<ol>
		<li>The <code>package</code> statement</li>
		<li><code>import</code> statements</li>
		<li>
			<code>component</code>, <code>system</code>, <code>action</code>, and
			<code>enum</code> statements
		</li>
	</ol>
	<p>
		The order of each <em>section</em> must be as defined above. Here's an
		example:
	</p>
	<pre><code ecsactLangSyntax>
		// 1. Package
		main package my.example;

		// 2. Imports
		import other.example;
		import fancy;

		// 3. Everything else
		component MyExampleComponent {{ '{' }} /* ... */ {{ '}' }}
		system MyExampleSystem {{ '{' }} /* ... */ {{ '}' }}
		action MyExampleAction {{ '{' }} /* ... */ {{ '}' }}
	</code></pre>

	<h2 id="packages">Packages</h2>
	<p>
		Every <code>.ecsact</code> file is considered a <em>package</em>. A package
		has a name specified by the package statement at the top. The package
		statement must be the top-most statement.
	</p>
	<p>
		The name of the package may only be made of lowercase letters or the
		<code>.</code> character and must not contain the word 'ecsact'. Sequential
		<code>.</code> characters are not allowed.
	</p>
	<pre><code ecsactLangSyntax>
		// Top of .ecsact file
		package example;
	</code></pre>
	<h3 id="import-packages">Importing other packages</h3>
	<p>
		Packages can be imported by their name.
		<a [routerLink]="" fragment="main-package"><code>main</code></a> packages
		cannot be imported.
	</p>
	<pre><code ecsactLangSyntax>
		package example;

		import other.library;
	</code></pre>
	<p>
		Execution order of other package systems are in the order specified by your
		<code>import</code> statements. Consequentially that means all imported
		packages run before systems in the file that imports them. This can be
		easily negated by splitting your systems up into multiple packages and
		importing your packages in the order you'd like in the
		<a [routerLink]="" fragment="main-package"><code>main</code></a> package.
	</p>

	<h3 id="main-package">The <code>main</code> package</h3>
	<p>
		When running ecsact code generators there may be at most 1 package that is
		the
		<code>main</code> package specified with the <code>main</code> keyword
		before the <code>package</code> keyword.
		<span class="i24">warning</span> Some code generators <em>only</em> work
		with the main package. It is recommended that you have a main package for
		your project. If you're creating an ecsact library a main package is not
		very useful since main packages cannot be imported.
	</p>
	<pre><code ecsactLangSyntax>
		main package example;
	</code></pre>

	<h2 id="define-components">Defining Components</h2>
	<pre><code ecsactLangSyntax>
		component Position {{'{'}}
			int32 x;
			int32 y;
		{{'}'}}
	</code></pre>

	<h2 id="define-systems">Defining Systems</h2>
	<pre><code ecsactLangSyntax>
		// Apply poison damage to entity health over time
		system PoisonDamage {{'{'}}
			required readonly Poisoned;
			required Health;
		{{'}'}}
	</code></pre>

	<h2 id="define-actions">Defining Actions</h2>
	<p>
		Defining <em>only</em> systems and components can get you a simulation that
		works well, but that simulation will be fully deterministic without
		<strong>input</strong>. Actions are just like systems except they also can
		have <a [routerLink]="" fragment="fields">fields</a> and are only executed
		when asked to be. This makes actions a perfect candidate for player input.
	</p>
	<pre><code ecsactLangSyntax>
		// Entities controlled by player `player_id` starts attacking
		action Attack {{'{'}}
			int32 player_id;
			required readonly PlayerControlled;
			adds Attacking;
		{{'}'}}
	</code></pre>

	<h2 id="fields">Fields</h2>
	<p>Both components and actions may contain any number of fields</p>
	<h3 id="field-types">Field Types</h3>
	<table>
		<tr>
			<th>Type</th>
			<th>Size</th>
			<th>Description</th>
		</tr>
		<tr>
			<td><code>bool</code></td>
			<td>at least 1 bit</td>
			<td>Boolean. Can be <code>true</code> or <code>false</code>.</td>
		</tr>
		<tr>
			<td><code>i8</code></td>
			<td>1 byte</td>
			<td>Signed 8 bit integer.</td>
		</tr>
		<tr>
			<td><code>u8</code></td>
			<td>1 byte</td>
			<td>Unsigned 8 bit integer.</td>
		</tr>
		<tr>
			<td><code>i16</code></td>
			<td>2 byte</td>
			<td>Signed 16 bit integer.</td>
		</tr>
		<tr>
			<td><code>u16</code></td>
			<td>2 byte</td>
			<td>Unsigned 16 bit integer.</td>
		</tr>
		<tr>
			<td><code>i32</code></td>
			<td>4 byte</td>
			<td>Signed 32 bit integer.</td>
		</tr>
		<tr>
			<td><code>u32</code></td>
			<td>4 byte</td>
			<td>Unsigned 32 bit integer.</td>
		</tr>
		<tr>
			<td><code>f32</code></td>
			<td>4 bytes</td>
			<td>
				32 bit
				<a href="https://en.wikipedia.org/wiki/IEEE_754" target="_blank"
					>IEEE-754</a
				>
				decimal format.
			</td>
		</tr>
		<tr>
			<td><code>entity</code></td>
			<td>unspecified</td>
			<td>
				Opaque type that represents an entity ID. Likely an integer, but any
				access to the underlying type is considered undefined behaviour.
			</td>
		</tr>
	</table>

	<h2 id="interact-multiple-entity">Interacting with multiple entities</h2>
	<p>It is often required that entities</p>
	<h3 id="nested-systems">Nested Systems</h3>
	<p>
		The simplest way to interact with multiple entities is with nested systems.
		A nested system is a system that runs once for every entity the parent
		system is ran on.
	</p>
	<p>
		To declare a nested system simply declare your system within another system.
	</p>
	<pre><code ecsactLangSyntax>
		system ParentSystem {{'{'}}
			required Position;
			system NestedSystem {{'{'}}
				required ExampleComponent;
			{{'}'}}
		{{'}'}}
	</code></pre>
	<p>
		In the above the <code>NestedSystem</code> implementation has access the
		parent system (<code>ParentSystem</code>) components, but is implicitly
		<code>readonly</code>.
	</p>

	<h3 id="with-entity">
		Using the <code>with</code> keyword on <code>entity</code> fields
	</h3>
	<p>
		The <code>entity</code> field is used to store an entity ID on a
		<code>component</code> or an <code>action</code>. Using the
		<code>with</code> keyword systems can select components from
		<em>other</em> entities in the same execution context. Simply put systems
		and actions execute on 1 entity usually, but the <code>with</code> keyword
		allows a system to run on more than 1 entity at a time.
	</p>
	<p>
		For example lets say we have an <code>Attacking</code> component with an
		<code>entity</code> field holding the attack target.
	</p>
	<pre><code ecsactLangSyntax>
		component Attacking {{'{'}}
			entity target;
		{{'}'}}
	</code></pre>
	<p>
		We could then write a system that applies the attackers damage to the
		targets health.
	</p>
	<pre><code ecsactLangSyntax>
		system ApplyAttackDamage {{'{'}}
			required readonly AttackDamage;
			required readonly Attacking with target {{'{'}}
				required Health;
			{{'}'}}
		{{'}'}}
	</code></pre>
	<p>
		<code>ApplyAttackDamage</code> will run on every entity that has
		<code>AttackDamage</code> and <code>Attacking</code> with the
		<code>Attacking</code> <code>target</code> entity also having
		<code>Health</code>.
	</p>
</article>
